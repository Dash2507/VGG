# YOLO1 Keras Model

Introduction
---------------------------------------------------------------------------------------------------

This is a Keras implementation of YOLO1 neuron network. 

    YOLO Real-Time Object Detection : YOLO paper please reference to http://pjreddie.com/darknet/yolo/


Usage
---------------------------------------------------------------------------------------

Training and Debuging (need Python-OPENCV)

    Python main.py train [pretrained_Keras_model.h5]
    
    It will read-in all training images, so it maybe probably out of memory if trainSets is too large.
    
    
Train_on_batch

    Python main.py train_on_batch [pretrained_Keras_model.h5]
    
    It will only read-in 1 batch images for each training, so there is no out of memory issue. But may take
    longer time to train because of it read image from disk for every batch.
    
    
TestFile (need Python-OPENCV)

    Python main.py testfile pretrained_Keras_model.h5 [-thresh 0.6]
    
    It will show images with predicted bbox on the screen


TestVideo (need Python-OPENCV)

    Python main.py testvideo pretrained_Keras_model.h5 [-thresh 0.6]
    
    It will show video with predicted bbox on the screen
    
Testvideosocket (need Python-OPENCV)

    Python main.py testvideosocket pretrained_Keras_model.h5 [-thresh 0.6]
    
    Provide another method to test video/testimages, it act as image receiver, use imageClient.py to
    
        connect to it and provide the test video file or image files. 
        

Code explanation
---------------------------------------------------------------------------------------------

    main_bnum.py: entry point
    
    genregiontruth_bnum.py: prepare truth and train data
    
    detregionloss_bnum.py: loss function
    
    builtinModel.py: define object detection neueon network structure
    
    imagefordebug.txt: image for train debug use case
    
    detregion.cfg: parameter setting file


How to Training
------------------------------------------------------------------------------------------------

    1. Learning rate start from 0.1, if loss doesnt decrease for 3 epochs, learning rate decrease by 1/2.
        if loss doesnt decrease for 10*3 epochs, then stop training
        
    2. Trainging image is generated by randomly shifting, croping, fliping, contrasting, brighting dataset image.
        
    3. add COCO dataset to trainSets
    

Running enviroment
--------------------------------------------------------------------------------------------

Tools :

    Ubuntu 16.04 LTS 64-bit, Python 2.7.12
  
    Keras with tensorflow backend : Neoron Network training

    Python-OpenCV : display image and video on screen

DataSets :
  
    VOC : please reference http://pjreddie.com/darknet/yolo/ to create VOC datasets
    
    COCO : run coco_dataset_Creator.py, you may need to modify code to fit you folder path. It may take several hours 
            to download all images.

Directory structure :

    VGG/ : this git
    
    VOC/voc_label.py : generate VOC lables, you can get this file from http://pjreddie.com/darknet/yolo/
    
    VOC/VOCdevkit : VOC datasets
    
    COCO/annotations : COCO datasets (2014 train/val object instance, 2014 train/val person keypoints), you can get from
        http://mscoco.org/dataset/#download
    
    COCO/coco : MS COCO API, you can get from https://github.com/pdollar/coco
